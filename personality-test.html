<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€§æ ¼æµ‹è¯• - ä½ æ˜¯å“ªç§äººæ ¼ç±»å‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap');
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Noto Sans SC', sans-serif; min-height: 100vh; }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .card {
            background: white;
            border-radius: 24px;
            padding: 32px;
            max-width: 600px;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .title { font-size: 1.75rem; font-weight: 700; text-align: center; margin-bottom: 8px; }
        .subtitle { text-align: center; color: #666; margin-bottom: 24px; font-size: 0.9rem; }
        .question { margin-bottom: 24px; }
        .question-text { font-weight: 600; margin-bottom: 12px; font-size: 1.1rem; }
        .option {
            padding: 14px 18px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
        }
        .option:hover { border-color: #667eea; background: #f5f3ff; }
        .option.selected { border-color: #667eea; background: #ede9fe; }
        .btn-primary {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .btn-primary:hover { transform: scale(1.02); }
        .btn-secondary {
            padding: 12px 24px;
            background: #f3f4f6;
            color: #374151;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            cursor: pointer;
            margin: 4px;
            transition: all 0.2s;
        }
        .btn-secondary:hover { background: #e5e7eb; }
        .result-card {
            text-align: center;
            padding: 24px;
        }
        .result-type { font-size: 2rem; font-weight: 700; margin-bottom: 8px; }
        .result-desc { color: #666; line-height: 1.8; margin-bottom: 20px; }
        .progress-dots { display: flex; justify-content: center; gap: 8px; margin-bottom: 24px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; background: #e5e7eb; }
        .dot.active { background: #667eea; }
        .dot.completed { background: #764ba2; }
        .bg-style { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .history-item { padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 8px; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="gradient-bg">
        <div class="bg-style" id="bgStyle"></div>
        <div class="card" id="mainCard">
            <!-- Start Screen -->
            <div id="startScreen">
                <div class="title">ğŸ§  æ€§æ ¼æµ‹è¯•</div>
                <div class="subtitle">æ¢ç´¢ä½ çš„äººæ ¼ç±»å‹ï¼Œå‘ç°çœŸå®çš„è‡ªå·±</div>
                <div style="text-align: center; margin-bottom: 24px;">
                    <span style="display: inline-block; padding: 8px 16px; background: #f3f4f6; border-radius: 20px; font-size: 0.85rem; color: #666;">
                        ğŸ“Š 8é“é¢˜ Â· çº¦2åˆ†é’Ÿå®Œæˆ
                    </span>
                </div>
                <div style="margin-bottom: 24px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">ä½ çš„æ˜µç§°</label>
                    <input type="text" id="nickname" placeholder="è¾“å…¥æ˜µç§°" style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 1rem;">
                </div>
                <div style="margin-bottom: 24px;">
                    <label style="display: block; margin-bottom: 12px; font-weight: 500;">é€‰æ‹©èƒŒæ™¯é£æ ¼</label>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                        <div class="option" style="padding: 8px; text-align: center;" onclick="setBgStyle(0)">ğŸŒ¸ ç´«ç²‰æ¸å˜</div>
                        <div class="option" style="padding: 8px; text-align: center;" onclick="setBgStyle(1)">ğŸŒŠ è“ç»¿æ¸å˜</div>
                        <div class="option" style="padding: 8px; text-align: center;" onclick="setBgStyle(2)">ğŸŒ… æ©™çº¢æ¸å˜</div>
                        <div class="option" style="padding: 8px; text-align: center;" onclick="setBgStyle(3)">ğŸŒ™ æš—å¤œç´«</div>
                        <div class="option" style="padding: 8px; text-align: center;" onclick="setBgStyle(4)">ğŸŒ¿ æ¸…æ–°ç»¿</div>
                        <div class="option" style="padding: 8px; text-align: center;" onclick="setBgStyle(5)">ğŸŒº ç«ç‘°çº¢</div>
                        <div class="option" style="padding: 8px; text-align: center;" onclick="setBgStyle(6)">ğŸ’™ å¤©ç©ºè“</div>
                        <div class="option" style="padding: 8px; text-align: center;" onclick="setBgStyle(7)">ğŸ–¤ æå¤œé»‘</div>
                    </div>
                </div>
                <button class="btn-primary" onclick="startTest()">å¼€å§‹æµ‹è¯•</button>
                <div style="margin-top: 20px;">
                    <button class="btn-secondary" onclick="showHistory()">ğŸ“œ æµ‹è¯•å†å²</button>
                </div>
            </div>

            <!-- Question Screen -->
            <div id="questionScreen" style="display: none;">
                <div class="progress-dots" id="progressDots"></div>
                <div id="questionContainer"></div>
                <button class="btn-primary" onclick="nextQuestion()" id="nextBtn" style="display: none;">ä¸‹ä¸€é¢˜</button>
            </div>

            <!-- Result Screen -->
            <div id="resultScreen" style="display: none;">
                <div class="result-card" id="resultCard">
                    <div style="font-size: 3rem; margin-bottom: 12px;" id="resultEmoji">ğŸ¯</div>
                    <div class="result-type" id="resultType">åŠ è½½ä¸­...</div>
                    <div style="display: inline-block; padding: 6px 14px; background: #ede9fe; border-radius: 20px; font-size: 0.85rem; margin-bottom: 16px;" id="resultTag">
                        äººæ ¼ç±»å‹
                    </div>
                    <div class="result-desc" id="resultDesc">...</div>
                </div>
                <div style="text-align: center;">
                    <button class="btn-secondary" onclick="downloadImage()">ğŸ“¥ ä¸‹è½½å›¾ç‰‡</button>
                    <button class="btn-secondary" onclick="copyImage()">ğŸ“‹ å¤åˆ¶å›¾ç‰‡</button>
                    <button class="btn-secondary" onclick="restartTest()">ğŸ”„ é‡æ–°æµ‹è¯•</button>
                </div>
            </div>

            <!-- History Screen -->
            <div id="historyScreen" style="display: none;">
                <div class="title" style="font-size: 1.25rem;">ğŸ“œ æµ‹è¯•å†å²</div>
                <div id="historyList" style="margin-top: 16px; max-height: 300px; overflow-y: auto;"></div>
                <button class="btn-secondary" onclick="goBack()" style="margin-top: 16px;">è¿”å›</button>
            </div>
        </div>
    </div>

    <canvas id="canvas" style="display: none;"></canvas>

    <script>
        const bgStyles = [
            'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)',
            'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
            'linear-gradient(135deg, #4b134f 0%, #c94b4b 100%)',
            'linear-gradient(135deg, #56ab2f 0%, #a8e063 100%)',
            'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)',
            'linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%)',
            'linear-gradient(135deg, #232526 0%, #414345 100%)'
        ];

        let currentBgStyle = 0;
        let currentQuestion = 0;
        let answers = [];
        let userName = '';

        const questions = [
            {
                text: "åœ¨ç¤¾äº¤åœºåˆä¸­ï¼Œä½ é€šå¸¸ä¼šï¼Ÿ",
                options: [
                    { text: "ä¸»åŠ¨ç»“è¯†æ–°æœ‹å‹ï¼Œç²¾åŠ›å……æ²›", type: "E" },
                    { text: "ç­‰å¾…åˆ«äººæ¥æ­è¯ï¼Œæ¯”è¾ƒå®‰é™", type: "I" }
                ]
            },
            {
                text: "é¢å¯¹é—®é¢˜æ—¶ï¼Œä½ æ›´å€¾å‘äºï¼Ÿ",
                options: [
                    { text: "å‡­ç›´è§‰å’Œæ„Ÿè§‰åšå†³å®š", type: "N" },
                    { text: "é€»è¾‘åˆ†æï¼Œç†æ€§æ€è€ƒ", type: "S" }
                ]
            },
            {
                text: "åšå†³å®šæ—¶ï¼Œä½ æ›´çœ‹é‡ï¼Ÿ",
                options: [
                    { text: "è‡ªå·±çš„ä»·å€¼è§‚å’Œæ„Ÿå—", type: "F" },
                    { text: "å®¢è§‚äº‹å®å’Œå¯¹é”™", type: "T" }
                ]
            },
            {
                text: "ä½ æ›´å–œæ¬¢çš„ç”Ÿæ´»æ–¹å¼æ˜¯ï¼Ÿ",
                options: [
                    { text: "çµæ´»å¤šå˜ï¼Œå–œæ¬¢æ–°é²œæ„Ÿ", type: "P" },
                    { text: "æœ‰è®¡åˆ’æœ‰ç»„ç»‡ï¼ŒæŒ‰éƒ¨å°±ç­", type: "J" }
                ]
            },
            {
                text: "å·¥ä½œæˆ–å­¦ä¹ æ—¶ï¼Œä½ æ›´æ“…é•¿ï¼Ÿ",
                options: [
                    { text: "åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡", type: "P" },
                    { text: "ä¸“æ³¨å®Œæˆä¸€ä»¶äº‹", type: "J" }
                ]
            },
            {
                text: "å½“ä½ æ„Ÿåˆ°å‹åŠ›æ—¶ï¼Œä½ ä¼šï¼Ÿ",
                options: [
                    { text: "æ‰¾æœ‹å‹å€¾è¯‰", type: "E" },
                    { text: "ç‹¬è‡ªæ€è€ƒå†·é™", type: "I" }
                ]
            },
            {
                text: "ä½ æ›´å€¾å‘äºç›¸ä¿¡ï¼Ÿ",
                options: [
                    { text: "è‡ªå·±çš„ç›´è§‰å’Œçµæ„Ÿ", type: "N" },
                    { text: "å®é™…ç»éªŒå’Œäº‹å®", type: "S" }
                ]
            },
            {
                text: "åœ¨ä¸ä»–äººäº‰è®ºæ—¶ï¼Œä½ æ›´åœ¨ä¹ï¼Ÿ",
                options: [
                    { text: "åŒæ–¹æ„Ÿå—ï¼Œç»´æŠ¤å…³ç³»", type: "F" },
                    { text: "çœŸç›¸å’Œé€»è¾‘", type: "T" }
                ]
            }
        ];

        const personalities = {
            "INTJ": { emoji: "ğŸ¯", name: "æˆ˜ç•¥å®¶", desc: "ä½ æ˜¯å¤©ç”Ÿçš„æˆ˜ç•¥å®¶ï¼Œå…·æœ‰å‡ºè‰²çš„åˆ†æèƒ½åŠ›å’Œè¿œè§ã€‚ä½ å–„äºåˆ¶å®šé•¿æœŸè®¡åˆ’ï¼Œå¯¹ç›®æ ‡å’Œç†æƒ³æœ‰åšå®šçš„è¿½æ±‚ã€‚è™½ç„¶æœ‰æ—¶æ˜¾å¾—å†·æ¼ å’Œç‹¬ç«‹ï¼Œä½†ä½ å†…å¿ƒæœ‰ç€å¼ºçƒˆçš„ä¸ªäººæ„¿æ™¯ã€‚", tag: "ç‹¬ç«‹æ€è€ƒè€…" },
            "INTP": { emoji: "ğŸ§©", name: "é€»è¾‘å­¦å®¶", desc: "ä½ çƒ­çˆ±çŸ¥è¯†å’ŒçœŸç†ï¼Œå–„äºæ·±å…¥æ€è€ƒå¤æ‚çš„é—®é¢˜ã€‚ä½ å…·æœ‰å¼ºçƒˆçš„å¥½å¥‡å¿ƒå’Œåˆ›é€ åŠ›ï¼Œå–œæ¬¢ç†è®ºæ¢è®¨èƒœè¿‡å®é™…æ“ä½œã€‚ä½ è¿½æ±‚ç†è§£äº‹ç‰©çš„æœ¬è´¨ï¼Œå¸¸å¸¸æ²‰æµ¸åœ¨è‡ªå·±çš„æ€è€ƒä¸–ç•Œä¸­ã€‚", tag: "ç†æ€§æ¢ç´¢è€…" },
            "ENTJ": { emoji: "âš¡", name: "æŒ‡æŒ¥å®˜", desc: "ä½ æ˜¯å¤©ç”Ÿçš„é¢†å¯¼è€…ï¼Œå…·æœ‰å¼ºå¤§çš„å†³ç­–åŠ›å’Œæ‰§è¡ŒåŠ›ã€‚ä½ å–„äºåˆ†æé—®é¢˜ã€åˆ¶å®šç­–ç•¥ï¼Œå¹¶èƒ½å¤Ÿæœ‰æ•ˆåœ°ç»„ç»‡å’Œæ¿€åŠ±ä»–äººã€‚ä½ è¿½æ±‚æˆåŠŸå’Œæ•ˆç‡ï¼Œæœ‰æ—¶å¯èƒ½æ˜¾å¾—è¿‡äºç›´æ¥å’Œè‹›åˆ»ã€‚", tag: "å¤©ç”Ÿé¢†è¢–" },
            "ENTP": { emoji: "ğŸ’¡", name: "è¾©è®ºå®¶", desc: "ä½ æ€ç»´æ•æ·ï¼Œçˆ±å¥½è¾©è®ºå’Œæ¢è®¨æ–°æƒ³æ³•ã€‚ä½ å–„äºå‘ç°æœºä¼šå’Œåˆ›æ–°ç‚¹ï¼Œå–œæ¬¢æŒ‘æˆ˜ä¼ ç»Ÿè§‚å¿µã€‚ä½ å…·æœ‰å¼ºå¤§çš„è¯´æœåŠ›å’Œäººé™…äº¤å¾€èƒ½åŠ›ï¼Œä½†æœ‰æ—¶å¯èƒ½ç¼ºä¹è€å¿ƒå’Œä¸“æ³¨ã€‚", tag: "åˆ›æ„æ¨æ‰‹" },
            "INFJ": { emoji: "ğŸŒŸ", name: "æå€¡è€…", desc: "ä½ æ˜¯ç†æƒ³ä¸»ä¹‰è€…ï¼Œæœ‰ç€æ·±åˆ»çš„æ´å¯ŸåŠ›å’Œå¼ºçƒˆçš„åŒç†å¿ƒã€‚ä½ å–„äºç†è§£ä»–äººçš„éœ€æ±‚å’Œæƒ…æ„Ÿï¼Œè¿½æ±‚æœ‰æ„ä¹‰çš„ç›®æ ‡ã€‚ä½ å¸¸å¸¸ä¸ºäº†ç†æƒ³è€Œå¥‹æ–—ï¼Œä½†æœ‰æ—¶å¯èƒ½è¿‡äºè‡ªæˆ‘ç‰ºç‰²ã€‚", tag: "ç†æƒ³ä¸»ä¹‰è€…" },
            "INFP": { emoji: "ğŸ¦‹", name: "è°ƒåœè€…", desc: "ä½ å†…å¿ƒä¸°å¯Œã€æ•æ„Ÿç»†è…»ï¼Œé‡è§†ä¸ªäººä»·å€¼è§‚å’Œæƒ…æ„Ÿä½“éªŒã€‚ä½ å¯Œæœ‰åˆ›é€ åŠ›å’ŒåŒç†å¿ƒï¼Œå¸¸å¸¸è¿½æ±‚æ„ä¹‰å’Œç¾å¥½ã€‚ä½ å¿ è¯šäºè‡ªå·±çš„ç†æƒ³ï¼Œä½†æœ‰æ—¶å¯èƒ½è¿‡äºç†æƒ³åŒ–ã€‚", tag: "æ¢¦æƒ³å®¶" },
            "ENFJ": { emoji: "ğŸŒˆ", name: "ä¸»äººå…¬", desc: "ä½ æ˜¯å¤©ç”Ÿçš„é¢†å¯¼è€…ï¼Œå…·æœ‰å¼ºå¤§çš„æ²Ÿé€šèƒ½åŠ›å’ŒåŒç†å¿ƒã€‚ä½ å–„äºæ¿€åŠ±å’Œå¸®åŠ©ä»–äººï¼Œå…³æ³¨ä»–äººçš„æˆé•¿å’Œå‘å±•ã€‚ä½ è¿½æ±‚å’Œè°çš„äººé™…å…³ç³»ï¼Œå¸¸å¸¸æˆä¸ºå›¢é˜Ÿä¸­çš„ç²¾ç¥é¢†è¢–ã€‚", tag: "æ¸©æš–é¢†è¢–" },
            "ENFP": { emoji: "ğŸ”¥", name: "ç«é€‰è€…", desc: "ä½ å……æ»¡çƒ­æƒ…å’Œåˆ›é€ åŠ›ï¼Œå–„äºå‘ç°å¯èƒ½æ€§å¹¶æ¿€åŠ±ä»–äººã€‚ä½ çƒ­çˆ±è‡ªç”±å’Œåˆ›æ–°ï¼Œè®¨åŒè¢«è§„åˆ™æŸç¼šã€‚ä½ å…·æœ‰å¼ºå¤§çš„æ„ŸæŸ“åŠ›ï¼Œä½†æœ‰æ—¶å¯èƒ½ç¼ºä¹ä¸“æ³¨å’ŒåšæŒã€‚", tag: "çƒ­æƒ…åˆ›æ–°è€…" },
            "ISTJ": { emoji: "ğŸ“Š", name: "ç‰©æµå¸ˆ", desc: "ä½ æ˜¯å¯é ä¸”åŠ¡å®çš„äººï¼Œé‡è§†è´£ä»»å’Œç»„ç»‡ã€‚ä½ å–„äºåˆ†ææ•°æ®ï¼Œæ³¨é‡ç»†èŠ‚å’Œå®é™…æ•ˆæœã€‚ä½ éµå®ˆè§„åˆ™ã€å‹¤å¥‹åŠªåŠ›ï¼Œä½†æœ‰æ—¶å¯èƒ½è¿‡äºä¿å®ˆå’ŒåƒµåŒ–ã€‚", tag: "å¯é æ‰§è¡Œè€…" },
            "ISFJ": { emoji: "ğŸ›¡ï¸", name: "å®ˆå«è€…", desc: "ä½ å¿ è¯šã€ç»†å¿ƒä¸”å¯Œæœ‰ç‰ºç‰²ç²¾ç¥ã€‚ä½ å–„äºç…§é¡¾ä»–äººï¼Œé‡è§†ä¼ ç»Ÿå’Œè´£ä»»ã€‚ä½ é»˜é»˜ä»˜å‡ºã€ä¸æ±‚å›æŠ¥ï¼Œä½†æœ‰æ—¶å¯èƒ½å¿½è§†è‡ªå·±çš„éœ€æ±‚ã€‚", tag: "æ¸©æš–å®ˆæŠ¤è€…" },
            "ESTJ": { emoji: "ğŸ†", name: "æ€»ç»ç†", desc: "ä½ æ˜¯å¤©ç”Ÿçš„ç®¡ç†è€…ï¼Œå…·æœ‰å¼ºå¤§çš„ç»„ç»‡å’Œæ‰§è¡Œèƒ½åŠ›ã€‚ä½ é‡è§†è§„åˆ™å’Œæ•ˆç‡ï¼Œå–„äºé¢†å¯¼å›¢é˜Ÿè¾¾æˆç›®æ ‡ã€‚ä½ æœæ–­ç›´æ¥ï¼Œä½†æœ‰æ—¶å¯èƒ½æ˜¾å¾—è¿‡äºå¼ºç¡¬ã€‚", tag: "æ‰§è¡Œå¤§å¸ˆ" },
            "ESFJ": { emoji: "â¤ï¸", name: "æ‰§æ”¿å®˜", desc: "ä½ çƒ­æƒ…ã€å‹å¥½ä¸”å¯Œæœ‰è´£ä»»æ„Ÿã€‚ä½ å–„äºç…§é¡¾ä»–äººï¼Œé‡è§†ç¤¾ä¼šå’Œè°å’Œäººé™…å…³ç³»ã€‚ä½ ä¹äºåŠ©äººã€è®²ç©¶å®é™…ï¼Œä½†æœ‰æ—¶å¯èƒ½è¿‡äºåœ¨æ„ä»–äººè¯„ä»·ã€‚", tag: "ç¤¾äº¤è¾¾äºº" },
            "ISTP": { emoji: "ğŸ”§", name: "é‰´èµå®¶", desc: "ä½ å†·é™ã€åŠ¡å®ä¸”å–„äºåŠ¨æ‰‹æ“ä½œã€‚ä½ å–„äºåˆ†æå’Œè§£å†³å®é™…é—®é¢˜ï¼Œäº«å—å½“ä¸‹çš„ä½“éªŒã€‚ä½ ç‹¬ç«‹çµæ´»ï¼Œä½†æœ‰æ—¶å¯èƒ½æ˜¾å¾—å†·æ¼ å’Œå†²åŠ¨ã€‚", tag: "å®ç”¨ä¸»ä¹‰è€…" },
            "ISFP": { emoji: "ğŸ¨", name: "æ¢é™©å®¶", desc: "ä½ æ•æ„Ÿã€ç»†è…»ä¸”å¯Œæœ‰è‰ºæœ¯æ°”è´¨ã€‚ä½ é‡è§†ä¸ªäººè‡ªç”±å’Œå®¡ç¾ä½“éªŒï¼Œè¿½æ±‚å†…å¿ƒçš„å¹³é™ä¸ç¾å¥½ã€‚ä½ æ¸©æŸ”å‹å¥½ï¼Œä½†æœ‰æ—¶å¯èƒ½è¿‡äºè¢«åŠ¨å’Œé€ƒé¿å†²çªã€‚", tag: "è‰ºæœ¯çµé­‚" },
            "ESTP": { emoji: "ğŸª", name: "ä¼ä¸šå®¶", desc: "ä½ å……æ»¡æ´»åŠ›ã€å–„äºç¤¾äº¤ï¼Œäº«å—å†’é™©å’Œåˆºæ¿€ã€‚ä½ å–„äºæŠŠæ¡æœºä¼šã€çµæ´»å˜é€šï¼Œæ˜¯è¡ŒåŠ¨æ´¾ä»£è¡¨ã€‚ä½ ç›´ç‡å¦è¯šï¼Œä½†æœ‰æ—¶å¯èƒ½ç¼ºä¹è€å¿ƒå’Œé•¿è¿œè§„åˆ’ã€‚", tag: "è¡ŒåŠ¨æ´¾" },
            "ESFP": { emoji: "ğŸ­", name: "è¡¨æ¼”è€…", desc: "ä½ çƒ­æƒ…æ´‹æº¢ã€å……æ»¡æ´»åŠ›ï¼Œæ˜¯äººç¾¤ä¸­çš„å¼€å¿ƒæœã€‚ä½ å–„äºè¥é€ æ°›å›´ã€å¸¦åŠ¨æƒ…ç»ªï¼Œäº«å—å½“ä¸‹çš„å¿«ä¹ã€‚ä½ çœŸè¯šå‹å¥½ï¼Œä½†æœ‰æ—¶å¯èƒ½è¿‡äºå†²åŠ¨å’Œç¼ºä¹è§„åˆ’ã€‚", tag: "æ´»åŠ›å› å­" }
        };

        function setBgStyle(index) {
            currentBgStyle = index;
            document.querySelectorAll('.bg-style + .card ~ div .option').forEach(opt => opt.classList.remove('selected'));
            event.target.closest('.option').classList.add('selected');
            document.getElementById('bgStyle').style.background = bgStyles[index];
        }

        function startTest() {
            userName = document.getElementById('nickname').value || 'æœ‹å‹';
            currentQuestion = 0;
            answers = [];
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('questionScreen').style.display = 'block';
            showQuestion();
        }

        function showQuestion() {
            const container = document.getElementById('questionContainer');
            const q = questions[currentQuestion];

            let html = `<div class="question">
                <div class="question-text">${currentQuestion + 1}. ${q.text}</div>`;

            q.options.forEach((opt, i) => {
                html += `<div class="option" onclick="selectOption(${i})">${opt.text}</div>`;
            });

            html += '</div>';
            container.innerHTML = html;

            // Update progress dots
            const dots = document.getElementById('progressDots');
            dots.innerHTML = questions.map((_, i) =>
                `<div class="dot ${i < currentQuestion ? 'completed' : i === currentQuestion ? 'active' : ''}"></div>`
            ).join('');

            document.getElementById('nextBtn').style.display = 'none';
        }

        function selectOption(index) {
            const q = questions[currentQuestion];
            answers.push(q.options[index].type);

            document.querySelectorAll('.option').forEach((opt, i) => {
                opt.classList.toggle('selected', i === index);
            });

            document.getElementById('nextBtn').style.display = 'block';
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                showResult();
            }
        }

        function calculateResult() {
            const counts = { E: 0, I: 0, N: 0, S: 0, T: 0, F: 0, J: 0, P: 0 };
            answers.forEach(a => counts[a]++);

            let type = '';
            type += counts.E > counts.I ? 'E' : 'I';
            type += counts.N > counts.S ? 'N' : 'S';
            type += counts.T > counts.F ? 'T' : 'F';
            type += counts.J > counts.P ? 'J' : 'P';

            return type;
        }

        function showResult() {
            const type = calculateResult();
            const p = personalities[type];

            document.getElementById('questionScreen').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'block';

            document.getElementById('resultEmoji').textContent = p.emoji;
            document.getElementById('resultType').textContent = p.name;
            document.getElementById('resultTag').textContent = p.tag;
            document.getElementById('resultDesc').textContent = p.desc;

            // Save to history
            const history = JSON.parse(localStorage.getItem('personalityTestHistory') || '[]');
            history.unshift({ type: p.name, date: new Date().toLocaleDateString() });
            if (history.length > 10) history.pop();
            localStorage.setItem('personalityTestHistory', JSON.stringify(history));
        }

        function downloadImage() {
            generateImage();
        }

        function copyImage() {
            generateImage(true);
        }

        function generateImage(copy = false) {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const type = calculateResult();
            const p = personalities[type];

            canvas.width = 600;
            canvas.height = 800;

            // Draw gradient background
            const gradient = ctx.createLinearGradient(0, 0, 600, 800);
            gradient.addColorStop(0, bgStyles[currentBgStyle].split(' ')[1].replace('0%', '').replace(',', ''));
            gradient.addColorStop(1, bgStyles[currentBgStyle].split(' ')[2].replace('100%)', ''));

            const colors = ['#667eea,#764ba2', '#11998e,#38ef7d', '#f093fb,#f5576c', '#4b134f,#c94b4b', '#56ab2f,#a8e063', '#ff9a9e,#fecfef', '#89f7fe,#66a6ff', '#232526,#414345'];
            const [c1, c2] = colors[currentBgStyle].split(',');
            const grad = ctx.createLinearGradient(0, 0, 600, 800);
            grad.addColorStop(0, c1);
            grad.addColorStop(1, c2);
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, 600, 800);

            // White card
            ctx.fillStyle = 'white';
            ctx.roundRect(30, 30, 540, 740, 24);
            ctx.fill();

            // Emoji
            ctx.font = '80px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(p.emoji, 300, 120);

            // Title
            ctx.fillStyle = '#1f2937';
            ctx.font = 'bold 36px Noto Sans SC';
            ctx.fillText(p.name, 300, 190);

            // Tag
            ctx.fillStyle = '#ede9fe';
            ctx.font = '18px Noto Sans SC';
            const tagWidth = ctx.measureText(p.tag).width;
            ctx.roundRect(300 - tagWidth/2 - 20, 220, tagWidth + 40, 32, 16);
            ctx.fill();
            ctx.fillStyle = '#667eea';
            ctx.fillText(p.tag, 300, 242);

            // Description
            ctx.fillStyle = '#6b7280';
            ctx.font = '18px Noto Sans SC';
            const words = p.desc.split('');
            let line = '';
            let y = 300;
            const maxWidth = 480;
            const lineHeight = 28;

            words.forEach(word => {
                const testLine = line + word;
                if (ctx.measureText(testLine).width > maxWidth) {
                    ctx.fillText(line, 300, y);
                    line = word;
                    y += lineHeight;
                } else {
                    line = testLine;
                }
            });
            ctx.fillText(line, 300, y);

            // Name and date
            ctx.fillStyle = '#9ca3af';
            ctx.font = '16px Noto Sans SC';
            ctx.fillText(`${userName} Â· ${new Date().toLocaleDateString()}`, 300, 700);

            // Footer
            ctx.font = '14px Noto Sans SC';
            ctx.fillText('æ€§æ ¼æµ‹è¯• Â· Auto Tools', 300, 740);

            if (copy) {
                canvas.toBlob(blob => {
                    navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
                    alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                });
            } else {
                const link = document.createElement('a');
                link.download = `æ€§æ ¼æµ‹è¯•-${p.name}.png`;
                link.href = canvas.toDataURL();
                link.click();
            }
        }

        function restartTest() {
            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'block';
            document.getElementById('nickname').value = userName;
        }

        function showHistory() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('historyScreen').style.display = 'block';
            const history = JSON.parse(localStorage.getItem('personalityTestHistory') || '[]');
            const list = document.getElementById('historyList');

            if (history.length === 0) {
                list.innerHTML = '<div style="text-align: center; color: #999;">æš‚æ— æµ‹è¯•è®°å½•</div>';
            } else {
                list.innerHTML = history.map(h => `
                    <div class="history-item">
                        <strong>${h.type}</strong> - ${h.date}
                    </div>
                `).join('');
            }
        }

        function goBack() {
            document.getElementById('historyScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'block';
        }

        // Initialize
        document.getElementById('bgStyle').style.background = bgStyles[0];

        // Add roundRect polyfill
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
                if (w < 2 * r) r = w / 2;
                if (h < 2 * r) r = h / 2;
                this.beginPath();
                this.moveTo(x + r, y);
                this.arcTo(x + w, y, x + w, y + h, r);
                this.arcTo(x + w, y + h, x, y + h, r);
                this.arcTo(x, y + h, x, y, r);
                this.arcTo(x, y, x + w, y, r);
                this.closePath();
                return this;
            };
        }
    </script>
</body>
</html>
