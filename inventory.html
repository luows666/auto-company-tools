<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€æ˜“åº“å­˜ç®¡ç† - Auto Company</title>
    <meta name="description" content="ç®€å•æ˜“ç”¨çš„åº“å­˜ç®¡ç†å·¥å…·ï¼Œé€‚åˆå°å•†æˆ·ã€åº—é“ºã€ä»“åº“ inventory ç®¡ç†">
    <meta name="keywords" content="åº“å­˜ç®¡ç†,è¿›é”€å­˜,ä»“åº“ç®¡ç†,å•†å“ç®¡ç†,å°å•†æˆ·å·¥å…·">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { color: #fff; text-align: center; margin-bottom: 10px; font-size: 1.8rem; }
        .subtitle { color: rgba(255,255,255,0.6); text-align: center; margin-bottom: 20px; font-size: 0.9rem; }
        .header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .stats { display: flex; gap: 15px; flex-wrap: wrap; }
        .stat { background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 8px; color: #fff; }
        .stat-value { font-size: 1.5rem; font-weight: bold; }
        .stat-label { font-size: 0.75rem; color: rgba(255,255,255,0.6); }
        .search-bar { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .search-input { flex: 1; min-width: 200px; padding: 12px 16px; border: none; border-radius: 8px; font-size: 1rem; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s; }
        .btn-primary { background: #11998e; color: #fff; }
        .btn-primary:hover { background: #0d806d; }
        .btn-secondary { background: #667eea; color: #fff; }
        .btn-secondary:hover { background: #5a6fd6; }
        .btn-danger { background: #e74c3c; color: #fff; }
        .btn-danger:hover { background: #c0392b; }
        .btn-success { background: #27ae60; color: #fff; }
        .btn-success:hover { background: #219a52; }
        .toolbar { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .form-card { background: rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px; display: none; }
        .form-card.show { display: block; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .form-group { }
        .form-label { display: block; color: rgba(255,255,255,0.8); margin-bottom: 6px; font-size: 0.9rem; }
        .form-input { width: 100%; padding: 10px 14px; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; background: rgba(255,255,255,0.1); color: #fff; font-size: 1rem; }
        .form-input:focus { outline: none; border-color: #11998e; }
        .form-actions { display: flex; gap: 10px; margin-top: 15px; }
        .table-container { overflow-x: auto; background: rgba(255,255,255,0.05); border-radius: 12px; }
        table { width: 100%; border-collapse: collapse; color: #fff; }
        th, td { padding: 14px 16px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(255,255,255,0.1); font-weight: 600; font-size: 0.9rem; }
        td { font-size: 0.9rem; }
        tr:hover { background: rgba(255,255,255,0.05); }
        .stock-low { color: #e74c3c; font-weight: bold; }
        .stock-ok { color: #27ae60; }
        .stock-high { color: #f39c12; }
        .action-btns { display: flex; gap: 8px; }
        .btn-sm { padding: 6px 12px; font-size: 0.8rem; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; }
        .modal.show { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: #1a1a2e; padding: 30px; border-radius: 16px; max-width: 500px; width: 90%; color: #fff; }
        .modal-title { font-size: 1.5rem; margin-bottom: 20px; }
        .modal-actions { display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end; }
        .alert { padding: 12px 16px; border-radius: 8px; margin-bottom: 15px; }
        .alert-success { background: rgba(39, 174, 96, 0.2); border: 1px solid #27ae60; color: #27ae60; }
        .alert-error { background: rgba(231, 76, 60, 0.2); border: 1px solid #e74c3c; color: #e74c3c; }
        .empty-state { text-align: center; padding: 60px 20px; color: rgba(255,255,255,0.5); }
        .empty-icon { font-size: 4rem; margin-bottom: 20px; }
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; }
        .tab { padding: 10px 20px; background: rgba(255,255,255,0.1); border: none; border-radius: 8px 8px 0 0; color: rgba(255,255,255,0.7); cursor: pointer; }
        .tab.active { background: rgba(255,255,255,0.2); color: #fff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .filter-group { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .filter-select { padding: 10px 14px; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; background: rgba(255,255,255,0.1); color: #fff; font-size: 0.9rem; }
        @media (max-width: 768px) {
            .header { flex-direction: column; align-items: stretch; }
            .stats { justify-content: center; }
            th, td { padding: 10px 8px; font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¦ ç®€æ˜“åº“å­˜ç®¡ç†</h1>
        <p class="subtitle">å°å•†æˆ·ã€åº—é“ºã€ä»“åº“çš„ç®€å•åº“å­˜ç®¡ç†å·¥å…·</p>

        <div class="header">
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="totalItems">0</div>
                    <div class="stat-label">å•†å“ç§ç±»</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="totalStock">0</div>
                    <div class="stat-label">æ€»åº“å­˜</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="lowStock">0</div>
                    <div class="stat-label">åº“å­˜é¢„è­¦</div>
                </div>
            </div>
        </div>

        <div class="search-bar">
            <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢å•†å“åç§°ã€SKU...">
            <select class="filter-select" id="categoryFilter">
                <option value="">å…¨éƒ¨åˆ†ç±»</option>
            </select>
            <select class="filter-select" id="stockFilter">
                <option value="">å…¨éƒ¨åº“å­˜</option>
                <option value="low">åº“å­˜ä¸è¶³</option>
                <option value="normal">åº“å­˜æ­£å¸¸</option>
                <option value="high">åº“å­˜å……è¶³</option>
            </select>
        </div>

        <div class="toolbar">
            <button class="btn btn-primary" onclick="showAddForm()">â• æ·»åŠ å•†å“</button>
            <button class="btn btn-secondary" onclick="showStockInModal()">ğŸ“¥ å…¥åº“</button>
            <button class="btn btn-secondary" onclick="showStockOutModal()">ğŸ“¤ å‡ºåº“</button>
            <button class="btn btn-success" onclick="exportData()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
            <button class="btn" style="background: rgba(255,255,255,0.2); color: #fff;" onclick="importData()">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(event)">
        </div>

        <div class="form-card" id="addForm">
            <h3 style="color: #fff; margin-bottom: 15px;">æ·»åŠ /ç¼–è¾‘å•†å“</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">å•†å“åç§° *</label>
                    <input type="text" class="form-input" id="itemName" placeholder="è¾“å…¥å•†å“åç§°">
                </div>
                <div class="form-group">
                    <label class="form-label">SKU ç¼–ç </label>
                    <input type="text" class="form-input" id="itemSku" placeholder="å¯é€‰">
                </div>
                <div class="form-group">
                    <label class="form-label">åˆ†ç±»</label>
                    <input type="text" class="form-input" id="itemCategory" placeholder="å¦‚ï¼šé£Ÿå“ã€æ–‡å…·">
                </div>
                <div class="form-group">
                    <label class="form-label">å•ä½</label>
                    <input type="text" class="form-input" id="itemUnit" placeholder="å¦‚ï¼šä¸ªã€ç®±ã€ä»¶" value="ä¸ª">
                </div>
                <div class="form-group">
                    <label class="form-label">åº“å­˜æ•°é‡ *</label>
                    <input type="number" class="form-input" id="itemStock" placeholder="0" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">é¢„è­¦æ•°é‡</label>
                    <input type="number" class="form-input" id="itemMinStock" placeholder="10" value="10">
                </div>
                <div class="form-group">
                    <label class="form-label">è¿›ä»· (å…ƒ)</label>
                    <input type="number" class="form-input" id="itemCost" placeholder="0" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label">å”®ä»· (å…ƒ)</label>
                    <input type="number" class="form-input" id="itemPrice" placeholder="0" min="0" step="0.01">
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" onclick="saveItem()">ğŸ’¾ ä¿å­˜</button>
                <button class="btn" style="background: rgba(255,255,255,0.2); color: #fff;" onclick="hideAddForm()">å–æ¶ˆ</button>
            </div>
        </div>

        <div class="alert" id="alert" style="display: none;"></div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>å•†å“åç§°</th>
                        <th>SKU</th>
                        <th>åˆ†ç±»</th>
                        <th>å•ä½</th>
                        <th>åº“å­˜</th>
                        <th>çŠ¶æ€</th>
                        <th>è¿›ä»·</th>
                        <th>å”®ä»·</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="inventoryTable">
                </tbody>
            </table>
        </div>

        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-icon">ğŸ“¦</div>
            <p>æš‚æ— å•†å“ï¼Œç‚¹å‡»"æ·»åŠ å•†å“"å¼€å§‹ç®¡ç†åº“å­˜</p>
        </div>
    </div>

    <!-- å…¥åº“å¼¹çª— -->
    <div class="modal" id="stockInModal">
        <div class="modal-content">
            <h3 class="modal-title">ğŸ“¥ å…¥åº“</h3>
            <div class="form-group">
                <label class="form-label">é€‰æ‹©å•†å“</label>
                <select class="form-input" id="stockInItem"></select>
            </div>
            <div class="form-group">
                <label class="form-label">å…¥åº“æ•°é‡</label>
                <input type="number" class="form-input" id="stockInQty" min="1" value="1">
            </div>
            <div class="form-group">
                <label class="form-label">å¤‡æ³¨</label>
                <input type="text" class="form-input" id="stockInNote" placeholder="å¯é€‰">
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="doStockIn()">ç¡®è®¤å…¥åº“</button>
                <button class="btn" style="background: rgba(255,255,255,0.2); color: #fff;" onclick="closeModal('stockInModal')">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- å‡ºåº“å¼¹çª— -->
    <div class="modal" id="stockOutModal">
        <div class="modal-content">
            <h3 class="modal-title">ğŸ“¤ å‡ºåº“</h3>
            <div class="form-group">
                <label class="form-label">é€‰æ‹©å•†å“</label>
                <select class="form-input" id="stockOutItem"></select>
            </div>
            <div class="form-group">
                <label class="form-label">å‡ºåº“æ•°é‡</label>
                <input type="number" class="form-input" id="stockOutQty" min="1" value="1">
            </div>
            <div class="form-group">
                <label class="form-label">å¤‡æ³¨</label>
                <input type="text" class="form-input" id="stockOutNote" placeholder="å¯é€‰">
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="doStockOut()">ç¡®è®¤å‡ºåº“</button>
                <button class="btn" style="background: rgba(255,255,255,0.2); color: #fff;" onclick="closeModal('stockOutModal')">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨
        let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
        let editingId = null;
        let transactionLog = JSON.parse(localStorage.getItem('transactionLog')) || [];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            renderTable();
            updateStats();
            updateCategoryFilter();
        });

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveToStorage() {
            localStorage.setItem('inventory', JSON.stringify(inventory));
            localStorage.setItem('transactionLog', JSON.stringify(transactionLog));
        }

        // æ˜¾ç¤ºæç¤º
        function showAlert(message, type = 'success') {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = 'alert ' + (type === 'success' ? 'alert-success' : 'alert-error');
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 3000);
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const totalItems = inventory.length;
            const totalStock = inventory.reduce((sum, item) => sum + (parseInt(item.stock) || 0), 0);
            const lowStock = inventory.filter(item => item.stock <= item.minStock).length;

            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('totalStock').textContent = totalStock;
            document.getElementById('lowStock').textContent = lowStock;
        }

        // æ›´æ–°åˆ†ç±»ç­›é€‰
        function updateCategoryFilter() {
            const categories = [...new Set(inventory.map(item => item.category).filter(Boolean))];
            const select = document.getElementById('categoryFilter');
            select.innerHTML = '<option value="">å…¨éƒ¨åˆ†ç±»</option>' +
                categories.map(c => `<option value="${c}">${c}</option>`).join('');
        }

        // æ¸²æŸ“è¡¨æ ¼
        function renderTable() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const stockFilter = document.getElementById('stockFilter').value;

            let filtered = inventory.filter(item => {
                const matchSearch = !search ||
                    item.name.toLowerCase().includes(search) ||
                    (item.sku && item.sku.toLowerCase().includes(search));
                const matchCategory = !categoryFilter || item.category === categoryFilter;
                let matchStock = true;
                if (stockFilter === 'low') matchStock = item.stock <= item.minStock;
                else if (stockFilter === 'normal') matchStock = item.stock > item.minStock && item.stock <= item.minStock * 2;
                else if (stockFilter === 'high') matchStock = item.stock > item.minStock * 2;
                return matchSearch && matchCategory && matchStock;
            });

            const tbody = document.getElementById('inventoryTable');
            const emptyState = document.getElementById('emptyState');

            if (filtered.length === 0) {
                tbody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            tbody.innerHTML = filtered.map(item => {
                let stockClass = 'stock-ok';
                let stockStatus = 'æ­£å¸¸';
                if (item.stock <= item.minStock) {
                    stockClass = 'stock-low';
                    stockStatus = 'ä¸è¶³';
                } else if (item.stock > item.minStock * 2) {
                    stockClass = 'stock-high';
                    stockStatus = 'å……è¶³';
                }

                return `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.sku || '-'}</td>
                        <td>${item.category || '-'}</td>
                        <td>${item.unit}</td>
                        <td>${item.stock}</td>
                        <td class="${stockClass}">${stockStatus}</td>
                        <td>Â¥${item.cost || 0}</td>
                        <td>Â¥${item.price || 0}</td>
                        <td>
                            <div class="action-btns">
                                <button class="btn btn-sm btn-secondary" onclick="editItem('${item.id}')">ç¼–è¾‘</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteItem('${item.id}')">åˆ é™¤</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // æœç´¢å’Œç­›é€‰äº‹ä»¶
        document.getElementById('searchInput').addEventListener('input', renderTable);
        document.getElementById('categoryFilter').addEventListener('change', renderTable);
        document.getElementById('stockFilter').addEventListener('change', renderTable);

        // æ˜¾ç¤ºæ·»åŠ è¡¨å•
        function showAddForm() {
            document.getElementById('addForm').classList.add('show');
            document.getElementById('itemName').focus();
        }

        // éšè—æ·»åŠ è¡¨å•
        function hideAddForm() {
            document.getElementById('addForm').classList.remove('show');
            clearForm();
        }

        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            editingId = null;
            document.getElementById('itemName').value = '';
            document.getElementById('itemSku').value = '';
            document.getElementById('itemCategory').value = '';
            document.getElementById('itemUnit').value = 'ä¸ª';
            document.getElementById('itemStock').value = '';
            document.getElementById('itemMinStock').value = '10';
            document.getElementById('itemCost').value = '';
            document.getElementById('itemPrice').value = '';
        }

        // ä¿å­˜å•†å“
        function saveItem() {
            const name = document.getElementById('itemName').value.trim();
            const sku = document.getElementById('itemSku').value.trim();
            const category = document.getElementById('itemCategory').value.trim();
            const unit = document.getElementById('itemUnit').value.trim() || 'ä¸ª';
            const stock = parseInt(document.getElementById('itemStock').value) || 0;
            const minStock = parseInt(document.getElementById('itemMinStock').value) || 10;
            const cost = parseFloat(document.getElementById('itemCost').value) || 0;
            const price = parseFloat(document.getElementById('itemPrice').value) || 0;

            if (!name) {
                showAlert('è¯·è¾“å…¥å•†å“åç§°', 'error');
                return;
            }

            if (editingId) {
                const index = inventory.findIndex(item => item.id === editingId);
                if (index !== -1) {
                    inventory[index] = { ...inventory[index], name, sku, category, unit, stock, minStock, cost, price };
                }
                showAlert('å•†å“å·²æ›´æ–°');
            } else {
                const newItem = {
                    id: Date.now().toString(),
                    name, sku, category, unit, stock, minStock, cost, price,
                    createdAt: new Date().toISOString()
                };
                inventory.push(newItem);
                showAlert('å•†å“å·²æ·»åŠ ');
            }

            saveToStorage();
            renderTable();
            updateStats();
            updateCategoryFilter();
            hideAddForm();
        }

        // ç¼–è¾‘å•†å“
        function editItem(id) {
            const item = inventory.find(i => i.id === id);
            if (!item) return;

            editingId = id;
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemSku').value = item.sku || '';
            document.getElementById('itemCategory').value = item.category || '';
            document.getElementById('itemUnit').value = item.unit || 'ä¸ª';
            document.getElementById('itemStock').value = item.stock;
            document.getElementById('itemMinStock').value = item.minStock;
            document.getElementById('itemCost').value = item.cost || '';
            document.getElementById('itemPrice').value = item.price || '';

            document.getElementById('addForm').classList.add('show');
            document.getElementById('itemName').focus();
        }

        // åˆ é™¤å•†å“
        function deleteItem(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•†å“å—ï¼Ÿ')) return;

            inventory = inventory.filter(item => item.id !== id);
            saveToStorage();
            renderTable();
            updateStats();
            updateCategoryFilter();
            showAlert('å•†å“å·²åˆ é™¤');
        }

        // å…¥åº“
        function showStockInModal() {
            if (inventory.length === 0) {
                showAlert('è¯·å…ˆæ·»åŠ å•†å“', 'error');
                return;
            }
            const select = document.getElementById('stockInItem');
            select.innerHTML = inventory.map(item => `<option value="${item.id}">${item.name} (åº“å­˜: ${item.stock})</option>`).join('');
            document.getElementById('stockInModal').classList.add('show');
        }

        function doStockIn() {
            const itemId = document.getElementById('stockInItem').value;
            const qty = parseInt(document.getElementById('stockInQty').value) || 0;
            const note = document.getElementById('stockInNote').value.trim();

            if (qty <= 0) {
                showAlert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°é‡', 'error');
                return;
            }

            const item = inventory.find(i => i.id === itemId);
            if (item) {
                item.stock += qty;
                transactionLog.push({
                    type: 'in',
                    itemId: item.id,
                    itemName: item.name,
                    qty: qty,
                    note: note,
                    time: new Date().toISOString()
                });
                saveToStorage();
                renderTable();
                updateStats();
                closeModal('stockInModal');
                showAlert(`å·²å…¥åº“ ${qty} ${item.unit} ${item.name}`);
            }
        }

        // å‡ºåº“
        function showStockOutModal() {
            if (inventory.length === 0) {
                showAlert('è¯·å…ˆæ·»åŠ å•†å“', 'error');
                return;
            }
            const select = document.getElementById('stockOutItem');
            select.innerHTML = inventory.map(item => `<option value="${item.id}">${item.name} (åº“å­˜: ${item.stock})</option>`).join('');
            document.getElementById('stockOutModal').classList.add('show');
        }

        function doStockOut() {
            const itemId = document.getElementById('stockOutItem').value;
            const qty = parseInt(document.getElementById('stockOutQty').value) || 0;
            const note = document.getElementById('stockOutNote').value.trim();

            if (qty <= 0) {
                showAlert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°é‡', 'error');
                return;
            }

            const item = inventory.find(i => i.id === itemId);
            if (item) {
                if (item.stock < qty) {
                    showAlert('åº“å­˜ä¸è¶³', 'error');
                    return;
                }
                item.stock -= qty;
                transactionLog.push({
                    type: 'out',
                    itemId: item.id,
                    itemName: item.name,
                    qty: qty,
                    note: note,
                    time: new Date().toISOString()
                });
                saveToStorage();
                renderTable();
                updateStats();
                closeModal('stockOutModal');
                showAlert(`å·²å‡ºåº“ ${qty} ${item.unit} ${item.name}`);
            }
        }

        // å…³é—­å¼¹çª—
        function closeModal(id) {
            document.getElementById(id).classList.remove('show');
            if (id === 'stockInModal') {
                document.getElementById('stockInQty').value = 1;
                document.getElementById('stockInNote').value = '';
            }
            if (id === 'stockOutModal') {
                document.getElementById('stockOutQty').value = 1;
                document.getElementById('stockOutNote').value = '';
            }
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const data = {
                inventory: inventory,
                transactionLog: transactionLog,
                exportTime: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventory_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showAlert('æ•°æ®å·²å¯¼å‡º');
        }

        // å¯¼å…¥æ•°æ®
        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.inventory && Array.isArray(data.inventory)) {
                        inventory = data.inventory;
                        if (data.transactionLog) {
                            transactionLog = data.transactionLog;
                        }
                        saveToStorage();
                        renderTable();
                        updateStats();
                        updateCategoryFilter();
                        showAlert(`æˆåŠŸå¯¼å…¥ ${inventory.length} æ¡å•†å“æ•°æ®`);
                    } else {
                        showAlert('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®', 'error');
                    }
                } catch (err) {
                    showAlert('è§£ææ–‡ä»¶å¤±è´¥', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }
    </script>
</body>
</html>
