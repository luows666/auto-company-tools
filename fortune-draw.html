<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥æŠ½ç­¾ç­’ - è¿åŠ¿æŠ½ç­¾</title>
    <meta name="description" content="æ¯æ—¥æŠ½ç­¾ç­’ï¼Œæ‘‡ä¸€æ‘‡æŠ½å‡ºä½ çš„ä»Šæ—¥è¿åŠ¿ï¼Œä¸€é”®ä¿å­˜å›¾ç‰‡åˆ†äº«åˆ°æœ‹å‹åœˆ">
    <meta name="keywords" content="æŠ½ç­¾,è¿åŠ¿,å åœ,æ±‚ç­¾,æ¯æ—¥è¿åŠ¿,åˆ†äº«">
    <style>
        :root {
            --primary: #8b5cf6;
            --primary-dark: #7c3aed;
            --bg: #f5f3ff;
            --card: #ffffff;
            --text: #1f2937;
            --text-light: #6b7280;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 100px;
        }

        /* Floating Support Button */
        .floating-support {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .support-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 14px 20px;
            background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.4);
            transition: all 0.3s;
            text-decoration: none;
        }

        .support-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(245, 158, 11, 0.5);
        }

        h1 {
            text-align: center;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .subtitle {
            text-align: center;
            color: var(--text-light);
            font-size: 0.875rem;
            margin-bottom: 20px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 16px;
            font-family: inherit;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .draw-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 16px;
        }

        .draw-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        .draw-btn:active {
            transform: translateY(0);
        }

        .draw-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px) rotate(-5deg); }
            40% { transform: translateX(10px) rotate(5deg); }
            60% { transform: translateX(-10px) rotate(-5deg); }
            80% { transform: translateX(10px) rotate(5deg); }
        }

        .result-card {
            display: none;
            text-align: center;
            padding: 30px 20px;
            border-radius: 20px;
            margin-bottom: 16px;
            position: relative;
            overflow: hidden;
        }

        .result-card.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fortune-rank {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .fortune-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .fortune-content {
            font-size: 0.9rem;
            line-height: 1.8;
            color: rgba(255,255,255,0.9);
        }

        .fortune-icon {
            font-size: 3rem;
            margin-bottom: 12px;
        }

        .bg-styles {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .bg-style-btn {
            height: 40px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bg-style-btn:hover {
            border-color: var(--primary);
        }

        .bg-style-btn.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.3);
        }

        .bg-gradient-1 { background: linear-gradient(135deg, #667eea, #764ba2); }
        .bg-gradient-2 { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .bg-gradient-3 { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .bg-gradient-4 { background: linear-gradient(135deg, #43e97b, #38f9d7); }
        .bg-gradient-5 { background: linear-gradient(135deg, #fa709a, #fee140); }
        .bg-gradient-6 { background: linear-gradient(135deg, #a8edea, #fed6e3); }
        .bg-gradient-7 { background: linear-gradient(135deg, #ff9a9e, #fecfef); }
        .bg-gradient-8 { background: linear-gradient(135deg, #ffecd2, #fcb69f); }

        .action-btns {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .download-btn {
            background: #10b981;
            color: white;
        }

        .copy-btn {
            background: #3b82f6;
            color: white;
        }

        .action-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .history {
            background: var(--card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .history h3 {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-bottom: 12px;
        }

        .history-item {
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
            font-size: 0.875rem;
            display: flex;
            justify-content: space-between;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-rank {
            font-weight: 600;
        }

        .rank-daji { color: #dc2626; }
        .rank-zhongji { color: #f59e0b; }
        .rank-xiaoji { color: #22c55e; }
        .rank-weiji { color: #3b82f6; }
        .rank-xiong { color: #6b7280; }

        .tips {
            text-align: center;
            color: var(--text-light);
            font-size: 0.8rem;
            margin-top: 20px;
        }

        .back-home {
            display: block;
            text-align: center;
            color: var(--primary);
            text-decoration: none;
            padding: 12px;
            margin-top: 16px;
        }

        .back-home:hover {
            text-decoration: underline;
        }

        /* æŠ½ç­¾ç­’åŠ¨ç”» */
        .lottery-box {
            width: 120px;
            height: 160px;
            margin: 0 auto 20px;
            background: linear-gradient(145deg, #d4a574, #c4956a);
            border-radius: 8px 8px 60px 60px;
            position: relative;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }

        .lottery-box::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 20px;
            background: #c4956a;
            border-radius: 50%;
        }

        .lottery-box::after {
            content: 'ç­¾';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            color: rgba(255,255,255,0.3);
            font-weight: bold;
        }

        .lottery-box:hover {
            transform: translateY(-5px);
        }

        .lottery-box.drawing {
            animation: shake 0.5s ease-in-out infinite;
        }

        /* èƒŒæ™¯æ ·å¼ */
        .result-bg-1 { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .result-bg-2 { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; }
        .result-bg-3 { background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; }
        .result-bg-4 { background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; }
        .result-bg-5 { background: linear-gradient(135deg, #fa709a, #fee140); color: white; }
        .result-bg-6 { background: linear-gradient(135deg, #a8edea, #fed6e3); color: #333; }
        .result-bg-7 { background: linear-gradient(135deg, #ff9a9e, #fecfef); color: #333; }
        .result-bg-8 { background: linear-gradient(135deg, #ffecd2, #fcb69f); color: #333; }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ¯æ—¥æŠ½ç­¾ç­’</h1>
        <p class="subtitle">æ‘‡ä¸€æ‘‡æŠ½å‡ºä½ çš„ä»Šæ—¥è¿åŠ¿</p>

        <div class="card" id="inputCard">
            <label for="nickname">ä½ çš„æ˜µç§°</label>
            <input type="text" id="nickname" placeholder="è¾“å…¥æ˜µç§°" maxlength="20">

            <label>é€‰æ‹©èƒŒæ™¯é£æ ¼</label>
            <div class="bg-styles">
                <div class="bg-style-btn bg-gradient-1 active" data-bg="1"></div>
                <div class="bg-style-btn bg-gradient-2" data-bg="2"></div>
                <div class="bg-style-btn bg-gradient-3" data-bg="3"></div>
                <div class="bg-style-btn bg-gradient-4" data-bg="4"></div>
                <div class="bg-style-btn bg-gradient-5" data-bg="5"></div>
                <div class="bg-style-btn bg-gradient-6" data-bg="6"></div>
                <div class="bg-style-btn bg-gradient-7" data-bg="7"></div>
                <div class="bg-style-btn bg-gradient-8" data-bg="8"></div>
            </div>

            <button class="draw-btn" id="drawBtn">å¼€å§‹æŠ½ç­¾</button>
        </div>

        <div class="lottery-box hidden" id="lotteryBox"></div>

        <div class="result-card result-bg-1" id="resultCard">
            <div class="fortune-icon" id="fortuneIcon">ğŸ¯</div>
            <div class="fortune-rank" id="fortuneRank">å¤§å‰</div>
            <div class="fortune-title" id="fortuneTitle">ä¸Šå¤©çœ·é¡¾</div>
            <div class="fortune-content" id="fortuneContent">
                ä»Šæ—¥è¿åŠ¿æä½³ï¼åšä»»ä½•äº‹æƒ…éƒ½å¦‚æœ‰ç¥åŠ©ï¼Œé€‚åˆåšå‡ºé‡å¤§å†³å®šã€‚
            </div>
        </div>

        <div class="action-btns hidden" id="actionBtns">
            <button class="action-btn download-btn" id="downloadBtn">ğŸ“¥ ä¸‹è½½å›¾ç‰‡</button>
            <button class="action-btn copy-btn" id="copyBtn">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
        </div>

        <div class="card hidden" id="historyCard">
            <h3>æŠ½ç­¾å†å²</h3>
            <div id="historyList"></div>
        </div>

        <p class="tips">æ¯å¤©åªèƒ½æŠ½ç­¾ä¸€æ¬¡ï¼Œæ˜æ—¥å†æ¥å§~</p>

        <a href="index.html" class="back-home">â† è¿”å›å·¥å…·ç®±</a>
    </div>

    <script src="https://html2canvas.hertzwang.com/html2canvas.min.js"></script>
    <script>
        // è¿åŠ¿æ•°æ®
        const fortunes = [
            { rank: 'å¤§å‰', icon: 'ğŸŒŸ', title: 'ä¸Šå¤©çœ·é¡¾', content: 'ä»Šæ—¥è¿åŠ¿æä½³ï¼åšä»»ä½•äº‹æƒ…éƒ½å¦‚æœ‰ç¥åŠ©ï¼Œé€‚åˆåšå‡ºé‡å¤§å†³å®šã€‚å¯èƒ½ä¼šæœ‰æ„å¤–æƒŠå–œç­‰å¾…ç€ä½ ï¼Œä¿æŒä¹è§‚å¿ƒæ€ï¼Œå¥½è¿è‡ªç„¶ä¼šæ¥ã€‚' },
            { rank: 'å¤§å‰', icon: 'âœ¨', title: 'ç´«æ°”ä¸œæ¥', content: 'ç¥¥ç‘é™ä¸´ä»Šæ—¥ï¼è´µäººè¿æ—ºç››ï¼Œåšä»€ä¹ˆéƒ½æœ‰äººå¸®åŠ©ã€‚é€‚åˆè¡¨ç™½ã€ç­¾çº¦ã€æ±‚èŒç­‰é‡è¦äº‹é¡¹ã€‚' },
            { rank: 'ä¸­å‰', icon: 'ğŸ’«', title: 'é¡ºæ°´æ¨èˆŸ', content: 'ä»Šæ—¥è¿åŠ¿ä¸é”™ï¼åªè¦æŒ‰è®¡åˆ’è¡Œäº‹ï¼Œä¸€åˆ‡éƒ½ä¼šé¡ºåˆ©è¿›è¡Œã€‚é€‚åˆå¤„ç†ä¹‹å‰é—ç•™çš„é—®é¢˜ã€‚' },
            { rank: 'ä¸­å‰', icon: 'ğŸŒˆ', title: 'æ˜¥é£å¾—æ„', content: 'å¿ƒæƒ…æ„‰å¿«çš„ä¸€å¤©ï¼åšä»€ä¹ˆéƒ½å¾ˆæœ‰å¹²åŠ²ï¼Œå¯èƒ½ä¼šé‡åˆ°æ„æƒ³ä¸åˆ°çš„å¥½äº‹ã€‚é€‚åˆå¼€æ‹“æ–°äº‹ä¸šã€‚' },
            { rank: 'ä¸­å‰', icon: 'ğŸ€', title: 'é”¦ä¸Šæ·»èŠ±', content: 'ä»Šæ—¥è¿åŠ¿å¹³ç¨³ä¸Šå‡ï¼ä¹‹å‰åŠªåŠ›çš„äº‹æƒ…å¼€å§‹æœ‰å›æŠ¥äº†ã€‚ç»§ç»­ä¿æŒï¼Œèƒœåˆ©å°±åœ¨å‰æ–¹ã€‚' },
            { rank: 'å°å‰', icon: 'ğŸŒ¸', title: 'å¹³ç¨³è¿‡æ¸¡', content: 'ä»Šå¤©æ˜¯å¹³æ·¡ä½†å®‰å¿ƒçš„ä¸€å¤©ã€‚ä¸è¦è¿‡äºè¿½æ±‚å®Œç¾ï¼Œäº«å—å½“ä¸‹çš„å°ç¡®å¹¸ä¹Ÿæ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚' },
            { rank: 'å°å‰', icon: 'ğŸ¦‹', title: 'ç»†æ°´é•¿æµ', content: 'è¿åŠ¿å¹³ç¨³ï¼Œé€‚åˆä¿®èº«å…»æ€§ã€‚ä»Šå¤©é€‚åˆå­¦ä¹ æ–°çŸ¥è¯†ï¼Œæˆ–è€…é™ªä¼´å®¶äººæœ‹å‹ã€‚' },
            { rank: 'å°å‰', icon: 'ğŸŒ™', title: 'é™æ°´æ·±æµ', content: 'è¡¨é¢å¹³é™ï¼Œå®åˆ™ç§¯ç´¯èƒ½é‡çš„ä¸€å¤©ã€‚ä¸å®œå†’è¿›ï¼Œç¨³æ‰ç¨³æ‰“æ‰æ˜¯ä¸Šç­–ã€‚é€‚åˆè§„åˆ’æœªæ¥ã€‚' },
            { rank: 'æœ«å‰', icon: 'ğŸ‚', title: 'å®¡æ—¶åº¦åŠ¿', content: 'ä»Šæ—¥éœ€è¦å¤šåŠ å°å¿ƒã€‚å¯èƒ½ä¼šé‡åˆ°ä¸€äº›å°éº»çƒ¦ï¼Œä½†åªè¦è°¨æ…è¡Œäº‹å°±èƒ½åŒ–è§£ã€‚é€‚åˆåæ€æ€»ç»“ã€‚' },
            { rank: 'æœ«å‰', icon: 'â³', title: 'åšç§¯è–„å‘', content: 'ç›®å‰è¿˜åœ¨ç§¯ç´¯é˜¶æ®µï¼Œä¸è¦æ€¥äºæ±‚æˆã€‚ä»Šå¤©çš„æ¯ä¸€ä»½ä»˜å‡ºï¼Œéƒ½ä¼šåœ¨æœªæ¥è·å¾—å›æŠ¥ã€‚' },
            { rank: 'å‡¶', icon: 'ğŸŒ§ï¸', title: 'è°¨è¨€æ…è¡Œ', content: 'ä»Šæ—¥è¿åŠ¿ä¸ä½³ï¼Œå»ºè®®ä½è°ƒè¡Œäº‹ã€‚é¿å…ä¸äººå‘ç”Ÿå†²çªï¼Œå¤šåšå°‘è¯´ä¸ºå¦™ã€‚å¯ä»¥è¯»è¯»ä¹¦ã€é™å¿ƒå…»æ€§ã€‚' },
            { rank: 'å‡¶', icon: 'â›ˆï¸', title: 'éŸ¬å…‰å…»æ™¦', content: 'ä»Šå¤©å¯èƒ½ä¼šé‡åˆ°ä¸€äº›æŒ‘æˆ˜ã€‚å»ºè®®æš‚æ—¶é€€è®©ï¼Œä¸è¦ç¡¬ç¢°ç¡¬ã€‚ä¿å­˜å®åŠ›ï¼Œç­‰å¾…æ—¶æœºã€‚' }
        ];

        let currentBg = 1;
        let currentResult = null;

        // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²æŠ½ç­¾
        function checkTodayDrawn() {
            const lastDraw = localStorage.getItem('fortuneDraw_lastDraw');
            if (lastDraw) {
                const lastDate = new Date(lastDraw).toDateString();
                const today = new Date().toDateString();
                if (lastDate === today) {
                    return true;
                }
            }
            return false;
        }

        // èƒŒæ™¯é€‰æ‹©
        document.querySelectorAll('.bg-style-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.bg-style-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentBg = parseInt(btn.dataset.bg);
                updateResultBg();
            });
        });

        function updateResultBg() {
            const resultCard = document.getElementById('resultCard');
            resultCard.className = 'result-card result-bg-' + currentBg;
        }

        // æŠ½ç­¾
        document.getElementById('drawBtn').addEventListener('click', draw);
        document.getElementById('lotteryBox').addEventListener('click', draw);

        function draw() {
            if (checkTodayDrawn()) {
                alert('ä½ ä»Šå¤©å·²ç»æŠ½è¿‡ç­¾äº†ï¼Œæ˜å¤©å†æ¥å§~');
                return;
            }

            const nickname = document.getElementById('nickname').value.trim() || 'å°ä¼™ä¼´';

            // æ˜¾ç¤ºæŠ½ç­¾ç­’åŠ¨ç”»
            const inputCard = document.getElementById('inputCard');
            const lotteryBox = document.getElementById('lotteryBox');
            const resultCard = document.getElementById('resultCard');
            const actionBtns = document.getElementById('actionBtns');

            inputCard.classList.add('hidden');
            lotteryBox.classList.remove('hidden');
            lotteryBox.classList.add('drawing');

            // æ¨¡æ‹ŸæŠ½ç­¾è¿‡ç¨‹
            setTimeout(() => {
                lotteryBox.classList.remove('drawing');
                lotteryBox.classList.add('hidden');

                // æ ¹æ®æ˜µç§°ç”Ÿæˆéšæœºç»“æœï¼ˆä¿è¯åŒä¸€æ˜µç§°åŒä¸€å¤©ç»“æœä¸€è‡´ï¼‰
                const today = new Date().toDateString();
                const seed = nickname.split('').reduce((a, c) => a + c.charCodeAt(0), 0) + today.split('').reduce((a, c) => a + c.charCodeAt(0), 0);
                const index = seed % fortunes.length;
                currentResult = fortunes[index];

                // æ˜¾ç¤ºç»“æœ
                document.getElementById('fortuneIcon').textContent = currentResult.icon;
                document.getElementById('fortuneRank').textContent = currentResult.rank;
                document.getElementById('fortuneRank').className = 'fortune-rank rank-' + currentResult.rank;
                document.getElementById('fortuneTitle').textContent = currentResult.title;
                document.getElementById('fortuneContent').textContent = currentResult.content;

                updateResultBg();
                resultCard.classList.add('show');
                actionBtns.classList.remove('hidden');

                // ä¿å­˜è®°å½•
                saveHistory(nickname, currentResult);

                // æ ‡è®°ä»Šå¤©å·²æŠ½ç­¾
                localStorage.setItem('fortuneDraw_lastDraw', new Date().toISOString());

                // è¿½è¸ªå·¥å…·ä½¿ç”¨
                trackToolUse('fortune-draw');

                // æ˜¾ç¤ºèµåŠ©æç¤º
                showSponsorHint();

            }, 1500);
        }

        // æ˜¾ç¤ºèµåŠ©æç¤º
        function showSponsorHint() {
            const hint = document.createElement('div');
            hint.id = 'sponsorHint';
            hint.innerHTML = 'ğŸ’– å–œæ¬¢è¿™ä¸ªå·¥å…·ï¼Ÿ<a href="payment-qr.html" target="_blank">â˜• èµåŠ©ä¸€æ¯å’–å•¡</a> æ”¯æŒæˆ‘ä»¬ï¼';
            hint.style.cssText = 'position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 10px 20px; border-radius: 25px; font-size: 14px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); z-index: 1000; animation: fadeInUp 0.5s ease;';
            document.body.appendChild(hint);
            setTimeout(() => {
                hint.style.opacity = '0';
                hint.style.transition = 'opacity 0.5s';
                setTimeout(() => hint.remove(), 500);
            }, 5000);
        }

        // ä¿å­˜å†å²è®°å½•
        function saveHistory(nickname, result) {
            const history = JSON.parse(localStorage.getItem('fortuneDraw_history') || '[]');
            const today = new Date().toLocaleDateString('zh-CN');
            history.unshift({
                date: today,
                nickname: nickname,
                rank: result.rank,
                title: result.title
            });
            if (history.length > 10) history.pop();
            localStorage.setItem('fortuneDraw_history', JSON.stringify(history));
            updateHistoryDisplay();
        }

        // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
        function updateHistoryDisplay() {
            const history = JSON.parse(localStorage.getItem('fortuneDraw_history') || '[]');
            const historyCard = document.getElementById('historyCard');
            const historyList = document.getElementById('historyList');

            if (history.length > 0) {
                historyCard.classList.remove('hidden');
                historyList.innerHTML = history.map(item => `
                    <div class="history-item">
                        <span>${item.date} ${item.nickname}</span>
                        <span class="history-rank rank-${item.rank}">${item.rank}</span>
                    </div>
                `).join('');
            }
        }

        // è¿½è¸ªå·¥å…·ä½¿ç”¨
        function trackToolUse(toolName) {
            const tools = JSON.parse(localStorage.getItem('toolUsage') || '{}');
            tools[toolName] = (tools[toolName] || 0) + 1;
            localStorage.setItem('toolUsage', JSON.stringify(tools));
        }

        // ä¸‹è½½å›¾ç‰‡
        document.getElementById('downloadBtn').addEventListener('click', async () => {
            const resultCard = document.getElementById('resultCard');
            try {
                const canvas = await html2canvas(resultCard, {
                    backgroundColor: null,
                    scale: 2
                });
                const link = document.createElement('a');
                link.download = 'ä»Šæ—¥æŠ½ç­¾.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            } catch (e) {
                alert('ç”Ÿæˆå›¾ç‰‡å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        });

        // å¤åˆ¶ç»“æœ
        document.getElementById('copyBtn').addEventListener('click', () => {
            const nickname = document.getElementById('nickname').value.trim() || 'å°ä¼™ä¼´';
            const text = `ã€${nickname}ã€‘ä»Šæ—¥æŠ½ç­¾ç»“æœ\n\n${currentResult.icon} ${currentResult.rank} - ${currentResult.title}\n\n${currentResult.content}\n\n#æ¯æ—¥æŠ½ç­¾ #è¿åŠ¿`;
            navigator.clipboard.writeText(text).then(() => {
                alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¿«å»åˆ†äº«å§ï¼');
            }).catch(() => {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        });

        // åˆå§‹åŒ–
        updateHistoryDisplay();

        // æ£€æŸ¥æ˜¯å¦ä»Šå¤©å·²æŠ½ç­¾ï¼Œå¦‚æœæ˜¯åˆ™æ˜¾ç¤ºä¸Šæ¬¡ç»“æœ
        if (checkTodayDrawn()) {
            const nickname = localStorage.getItem('fortuneDraw_lastNickname');
            if (nickname) {
                document.getElementById('nickname').value = nickname;
            }
            // æ˜¾ç¤ºæç¤º
            document.querySelector('.tips').textContent = 'ä½ ä»Šå¤©å·²ç»æŠ½è¿‡ç­¾äº†ï¼Œæ˜å¤©å†æ¥å§~';
        }
    </script>

    <!-- Floating Support Button -->
    <div class="floating-support">
        <a href="payment-qr.html" class="support-btn" target="_blank">
            <span>â˜•</span>
            <span>æ”¯æŒæˆ‘ä»¬</span>
        </a>
    </div>
</body>
</html>
